# MySoloKeeper - 打灰机守护程序

一个现代化的图形化"打灰机守护程序"，使用SmolVLM进行实时人脸识别，当检测到人类时自动最小化指定的程序窗口。

## 功能特性

- 🎯 **实时人脸检测**: 使用SmolVLM模型进行高精度人脸识别
- 🛡️ **进程守护**: 选择任意运行中的程序进行守护
- 📹 **摄像头监控**: 实时摄像头画面显示，红色框标记检测到的人脸
- 🔊 **声音报警**: 检测到人脸时播放声音提醒
- ⚡ **智能优化**: 坐标平滑处理，减少检测抖动
- 🎨 **现代界面**: 二次元风格的现代化图形界面
- 🔧 **灵活配置**: 可调节检测间隔、启用/禁用各种功能
- 🤖 **MediaPipe辅助**: 可选的MediaPipe人脸检测辅助功能

## 系统要求

- Windows 10/11 64位
- Python 3.8+
- 摄像头设备
- SmolVLM服务运行在 http://localhost:8080

## 快速开始

### 1. 启动SmolVLM服务

确保你的SmolVLM服务已经启动并运行在 `http://localhost:8080`。

### 2. 运行程序

**方法一：使用启动脚本（推荐）**
```bash
python start.py
```

启动脚本会自动：
- 检查Python版本
- 安装缺失的依赖库
- 检查SmolVLM服务状态
- 启动主程序

**方法二：手动安装依赖**
```bash
# 安装依赖
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple/

# 运行程序
python main.py
```

## 使用说明

### 基本操作

1. **启动程序**: 运行 `python start.py`
2. **开始识别**: 点击"开始识别"按钮启动摄像头和人脸检测
3. **选择进程**: 在右侧进程列表中选择要守护的程序
4. **启用守护**: 开启"启用守护"开关
5. **配置设置**: 根据需要调整检测间隔、声音报警等设置

### 界面说明

- **左侧面板**: 摄像头显示区域和检测控制
- **右侧面板**: 进程管理、守护设置和程序配置
- **状态栏**: 显示程序运行状态和SmolVLM连接状态

### 功能详解

#### 人脸检测
- 红色框：SmolVLM检测到的人脸
- 绿色框：MediaPipe辅助检测的人脸（可选）
- 支持多人脸同时检测
- 智能坐标平滑，减少检测抖动

#### 进程守护
- 自动扫描所有有窗口的运行进程
- 支持选择任意程序进行守护
- 检测到人脸时自动最小化目标程序窗口

#### 声音报警
- 检测到人脸时播放声音提醒
- 支持系统声音和自定义音频文件
- 可在设置中启用/禁用

## 配置选项

### 检测间隔
- 范围：0.1-5.0秒
- 建议：1.0秒（平衡性能和响应速度）

### MediaPipe辅助
- 启用后会同时使用MediaPipe进行人脸检测
- 绿色框显示MediaPipe检测结果
- 可提高检测准确性

### 声音报警
- 启用后检测到人脸时播放声音
- 支持自定义音频文件（放置alert.wav文件）

## 文件结构

```
MySoloKeeper/
├── main.py                 # 主程序入口
├── start.py                # 启动脚本
├── gui.py                  # 图形界面模块
├── camera_handler.py       # 摄像头处理模块
├── smolvlm_client.py      # SmolVLM API客户端
├── process_manager.py      # 进程管理模块
├── coordinate_processor.py # 坐标处理和平滑模块
├── audio_manager.py        # 声音管理模块
├── config.py              # 配置文件
├── requirements.txt       # 依赖列表
├── README.md              # 说明文档
└── models/                # SmolVLM模型文件目录
```

## 故障排除

### 常见问题

1. **摄像头无法启动**
   - 检查摄像头是否被其他程序占用
   - 确认摄像头权限设置
   - 尝试更换摄像头索引

2. **SmolVLM连接失败**
   - 确认SmolVLM服务正在运行
   - 检查端口8080是否被占用
   - 查看防火墙设置

3. **进程最小化失败**
   - 确认已安装pywin32库
   - 检查目标程序是否有管理员权限
   - 某些全屏程序可能无法最小化

4. **声音无法播放**
   - 检查系统音频设置
   - 确认pygame库正确安装
   - 尝试使用系统声音模式

### 性能优化

- 适当调整检测间隔以平衡性能和响应速度
- 在性能较低的设备上可以禁用MediaPipe辅助
- 确保摄像头分辨率设置合理

## 技术特性

- **高效的坐标处理**: 智能过滤无效坐标，平滑处理减少抖动
- **多线程架构**: 摄像头捕获、图像处理、界面更新分离
- **错误恢复**: 完善的异常处理和错误恢复机制
- **资源管理**: 自动释放摄像头和音频资源

## 许可证

本项目采用MIT许可证。详见LICENSE文件。

## 贡献

欢迎提交Issue和Pull Request来改进这个项目！
